{% extends 'layouts/case.html' %}
{% load crispy_forms_tags %}

{% block body %}
<div class="govuk-width-container">
    <a href="#" class="govuk-back-link">Back</a>
    <main class="govuk-main-wrapper">
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-three-quarters">
                <h1 class="govuk-heading-xl">View Advice</h1>
                <a role="button" draggable="false" class="govuk-button govuk-button--secondary" href="#edit-recommendation">
                    Edit recommendation
                </a>
                <a role="button" draggable="false" class="govuk-button govuk-button--secondary" href="#clear-recommendation">
                    Clear recommendation
                </a>

                <table class="govuk-table">
                    <h2 class="govuk-heading-m">My approval recommendation</h2>
                    <thead class="govuk-table__head">
                      <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Country</th>
                        <th scope="col" class="govuk-table__header">Type</th>
                        <th scope="col" class="govuk-table__header">Name</th>
                        <th scope="col" class="govuk-table__header">Approved products</th>
                      </tr>
                    </thead>
                    <tbody class="govuk-table__body">
                        {% if case.data.consignee %}
                            {% with consignee=case.data.consignee %}
                                <tr class="govuk-table__row">
                                    <td class="govuk-table__cell">{{ consignee.country.name }}</td>
                                    <td class="govuk-table__cell">{{ consignee.type|sentence_case }}</td>
                                    <td class="govuk-table__cell">{{ consignee.name }}</td>
                                    <td class="govuk-table__cell">All</td>
                                </tr>
                            {% endwith %}
                        {% endif %}
                        {% if case.data.end_user %}
                            {% with end_user=case.data.end_user %}
                                <tr class="govuk-table__row">
                                    <td class="govuk-table__cell">{{ end_user.country.name }}</td>
                                    <td class="govuk-table__cell">{{ end_user.type|sentence_case }}</td>
                                    <td class="govuk-table__cell">{{ end_user.name }}</td>
                                    <td class="govuk-table__cell">All</td>
                                </tr>
                            {% endwith %}
                        {% endif %}
                        {% if case.data.ultimate_end_users %}
                            {% for ultimate_end_user in case.data.ultimate_end_users %}
                                <tr class="govuk-table__row">
                                    <td class="govuk-table__cell">{{ ultimate_end_user.country.name }}</td>
                                    <td class="govuk-table__cell">{{ ultimate_end_user.type|sentence_case }}</td>
                                    <td class="govuk-table__cell">{{ ultimate_end_user.name }}</td>
                                    <td class="govuk-table__cell">All</td>
                                </tr>
                            {% endfor %}
                        {% endif %}
                    </tbody>
                </table>

                <br>

                <div class="govuk-cookie-banner " data-nosnippet role="region" aria-label="Reason for approving">
                    <div class="govuk-cookie-banner__message govuk-width-container">
                  
                      <div class="govuk-grid-row">
                        <div class="govuk-grid-column-two-thirds">
                          {% if my_advice|length %}
                            {% with advice=my_advice.0 %}
                              <h2 class="govuk-heading-m">Reason for approving</h2>
                              <div class="govuk-cookie-banner__content">
                                <p class="govuk-body">{{ advice.text }}</p>
                              </div>

                              {% if advice.proviso %}
                                <h2 class="govuk-heading-m">Licence condition</h2>
                                <div class="govuk-cookie-banner__content">
                                    <p class="govuk-body">{{ advice.proviso }}</p>
                                </div>
                              {% endif %}

                              {% if advice.note %}
                                <h2 class="govuk-heading-m">Additional instructions</h2>
                                <div class="govuk-cookie-banner__content">
                                    <p class="govuk-body">{{ advice.note }}</p>
                                </div>
                              {% endif %}

                            {% endwith %}
                          {% endif %}
                        </div>
                      </div>
                    </div>
                </div>

                <br><br>

                {% if nlr_products|length %}
                  <table class="govuk-table">
                    <caption class="govuk-table__caption govuk-table__caption--m">No licence required products</caption>
                    <thead class="govuk-table__head">
                      <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Product name</th>
                      </tr>
                    </thead>
                    <tbody class="govuk-table__body">
                      {% for product in nlr_products %}
                      <tr class="govuk-table__row">
                        <td class="govuk-table__cell">{{ product.good.name }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                {% else %}
                  <h2 class="govuk-heading-m">No licence required products</h2>
                  <label class="govuk-label">None</label>
                {% endif %}
              </div>
            <div class="govuk-grid-column-one-quarter">
                <a role="button" draggable="false" class="govuk-button" href="#move-forward">
                    Move case forward >
                </a>
            </div>
        </div>
    </main>
</div>
{% endblock %}
