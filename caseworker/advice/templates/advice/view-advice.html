{% extends 'layouts/case.html' %}

{% load static custom_tags %}

{% block header_tabs %}
	{% include "advice/case-tabs.html" with case=case queue=queue %}
{% endblock %}

{% block full_width %}

{% if my_advice %}

<div id="my-advice">
	{% include "advice/view_my_advice.html" %}

	{% if nlr_products %}
	<div class="govuk-grid-row">
		<div class="govuk-grid-column-three-quarters">

			<table class="govuk-table table-nlr-products">
				<caption class="govuk-table__caption govuk-!-font-size-19 govuk-!-font-weight-bold govuk-body govuk-!-padding-2 app-bg-colour--mid-grey">No licence required products</caption>
				<thead class="govuk-table__head">
					<tr class="govuk-table__row">
						<th scope="col" class="govuk-table__header">Product name</th>
						<th scope="col" class="govuk-table__header">Product description</th>
					</tr>
				</thead>
				<tbody class="govuk-table__body">
					{% for product in nlr_products %}
					<tr class="govuk-table__row">
						<td class="govuk-table__cell">{{ product.good.name|default:"N/A" }}</td>
						<td class="govuk-table__cell">{{ product.good.description }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>

		</div>
	</div>
	{% else %}
	<h2 class="govuk-heading-m">No licence required products</h2>
	<p class="govuk-body">None</p>
	{% endif %}
</div>

{% else %}
	<a draggable="false" class="govuk-button govuk-button--primary" href="{% url 'cases:select_advice' queue_pk case.id %}">Give advice</a>
{% endif %}

{% if grouped_advice %}

<h2 class="govuk-heading-m">Other recommendations for this case</h2>

<div class="govuk-grid-row">
<div class="govuk-grid-column-three-quarters">

{% for team_advice in grouped_advice %}
	<details class="govuk-details" data-module="govuk-details">
		<summary class="govuk-details__summary">
			<span class="govuk-details__summary-text govuk-!-font-weight-bold">
				{{ team_advice.team.name }}
			</span>
		</summary>

			<div class="govuk-details__text">
				{% for user_decision_advice in team_advice.advice %}

				{% if user_decision_advice.decision in 'Approve,Proviso' %}
					{% include "advice/approve-advice-details.html" %}
				{% elif user_decision_advice.decision == "Refuse" %}
					{% include "advice/refuse-advice-details.html" %}
				{% endif %}

				{% endfor %}
			</div>
	</details>
{% endfor %}

{% endif %}

{% if not my_advice and not grouped_advice %}
<h2 class="govuk-heading-m">There is no advice for this case yet</h2>
<a draggable="false" class="govuk-button govuk-button--primary" href="{% url 'cases:select_advice' queue_pk case.id %}">Give advice</a>
{% endif %}

</div>
</div>

{% endblock %}
