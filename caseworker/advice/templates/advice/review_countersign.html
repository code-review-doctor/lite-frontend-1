{% extends 'layouts/case.html' %}

{% load static custom_tags %}
{% load crispy_forms_tags %}


{% block body %}
<div class="govuk-width-container">
    {% if form.has_changed %}
        <a href="{% url 'cases:view_my_advice' queue_pk case.id %}" class="govuk-back-link">Back</a>
    {% else %}
        <a href="{% url 'cases:select_advice' queue_pk case.id %}" class="govuk-back-link">Back</a>
    {% endif %}
    <main class="govuk-main-wrapper">
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-two-thirds">
                <h2 class="govuk-heading-xl">Review and countersign</h2>
                <form action="." method="POST">
                    {{ formset.management_form|crispy }}
                    {% if advice_to_countersign|length %}
                        {% for advice in advice_to_countersign %}
                            {% with form=formset|index:forloop.counter0 %}
                                <!-- custom layout for each form -->
                                {% if advice.type.key in 'approve,proviso' %}
                                    {% include "advice/approve-advice-details.html" %}
                                {% elif advice.type.key == "refuse" %}
                                    {% include "advice/refuse-advice-details.html" %}
                                {% endif %}

                                <br><br>

                                <!-- Render the form -->
                                {% crispy form %}

                                <br>

                            {% endwith %}
                        {% endfor %}
                    {% endif %}
                    <div class="form-actions"> <input type="submit" name="submit" value="Submit" class="govuk-button" id="submit-id-submit"> </div>
                </form>
            </div>
            <div class="govuk-grid-column-one-thirds">
                {% include "advice/case_detail.html" %}
            </div>
        </div>
    </main>
</div>
{% endblock %}
