!function(){function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};
/**
 *
 *
 * @author Jerry Bendy <jerry@icewingcc.com>
 * @licence MIT
 *
 */
!function(e){var t,s=function(){try{if(e.URLSearchParams&&"bar"===new e.URLSearchParams("foo=bar").get("foo"))return e.URLSearchParams}catch(e){}return null}(),i=s&&"a=1"===new s({a:1}).toString(),n=s&&"+"===new s("s=%2B").get("s"),r=!s||((t=new s).append("s"," &"),"s=+%26"===t.toString()),o=h.prototype,l=!(!e.Symbol||!e.Symbol.iterator);if(!(s&&i&&n&&r)){o.append=function(e,t){p(this.__URLSearchParams__,e,t)},o.delete=function(e){delete this.__URLSearchParams__[e]},o.get=function(e){var t=this.__URLSearchParams__;return this.has(e)?t[e][0]:null},o.getAll=function(e){var t=this.__URLSearchParams__;return this.has(e)?t[e].slice(0):[]},o.has=function(e){return v(this.__URLSearchParams__,e)},o.set=function(e,t){this.__URLSearchParams__[e]=[""+t]},o.toString=function(){var e,t,s,i,n=this.__URLSearchParams__,r=[];for(t in n)for(s=c(t),e=0,i=n[t];e<i.length;e++)r.push(s+"="+c(i[e]));return r.join("&")};var a=!!n&&s&&!i&&e.Proxy;Object.defineProperty(e,"URLSearchParams",{value:a?new Proxy(s,{construct:function(e,t){return new e(new h(t[0]).toString())}}):h});var u=e.URLSearchParams.prototype;u.polyfill=!0,u.forEach=u.forEach||function(e,t){var s=f(this.toString());Object.getOwnPropertyNames(s).forEach((function(i){s[i].forEach((function(s){e.call(t,s,i,this)}),this)}),this)},u.sort=u.sort||function(){var e,t,s,i=f(this.toString()),n=[];for(e in i)n.push(e);for(n.sort(),t=0;t<n.length;t++)this.delete(n[t]);for(t=0;t<n.length;t++){var r=n[t],o=i[r];for(s=0;s<o.length;s++)this.append(r,o[s])}},u.keys=u.keys||function(){var e=[];return this.forEach((function(t,s){e.push(s)})),m(e)},u.values=u.values||function(){var e=[];return this.forEach((function(t){e.push(t)})),m(e)},u.entries=u.entries||function(){var e=[];return this.forEach((function(t,s){e.push([s,t])})),m(e)},l&&(u[e.Symbol.iterator]=u[e.Symbol.iterator]||u.entries)}function h(e){((e=e||"")instanceof URLSearchParams||e instanceof h)&&(e=e.toString()),this.__URLSearchParams__=f(e)}function c(e){var t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'\(\)~]|%20|%00/g,(function(e){return t[e]}))}function d(e){return e.replace(/[ +]/g,"%20").replace(/(%[a-f0-9]{2})+/gi,(function(e){return decodeURIComponent(e)}))}function m(t){var s={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return l&&(s[e.Symbol.iterator]=function(){return s}),s}function f(e){var t={};if("object"==typeof e)if(g(e))for(var s=0;s<e.length;s++){var i=e[s];if(!g(i)||2!==i.length)throw new TypeError("Failed to construct 'URLSearchParams': Sequence initializer must only contain pair elements");p(t,i[0],i[1])}else for(var n in e)e.hasOwnProperty(n)&&p(t,n,e[n]);else{0===e.indexOf("?")&&(e=e.slice(1));for(var r=e.split("&"),o=0;o<r.length;o++){var l=r[o],a=l.indexOf("=");-1<a?p(t,d(l.slice(0,a)),d(l.slice(a+1))):l&&p(t,d(l),"")}}return t}function p(e,t,s){var i="string"==typeof s?s:null!=s&&"function"==typeof s.toString?s.toString():JSON.stringify(s);v(e,t)?e[t].push(i):e[t]=[i]}function g(e){return!!e&&"[object Array]"===Object.prototype.toString.call(e)}function v(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(void 0!==t?t:"undefined"!=typeof window?window:{}),function(){if(!self.fetch){o.prototype.append=function(e,t){e=n(e),t=r(t);var s=this.map[e];s||(s=[],this.map[e]=s),s.push(t)},o.prototype.delete=function(e){delete this.map[n(e)]},o.prototype.get=function(e){var t=this.map[n(e)];return t?t[0]:null},o.prototype.getAll=function(e){return this.map[n(e)]||[]},o.prototype.has=function(e){return this.map.hasOwnProperty(n(e))},o.prototype.set=function(e,t){this.map[n(e)]=[r(t)]},o.prototype.forEach=function(e){var t=this;Object.getOwnPropertyNames(this.map).forEach((function(s){e(s,t.map[s])}))};var e="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),t="FormData"in self,s=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],i=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);h.call(c.prototype),h.call(f.prototype),self.Headers=o,self.Request=c,self.Response=f,self.fetch=function(t,s){var n;return n=c.prototype.isPrototypeOf(t)&&!s?t:new c(t,s),new fetch.Promise((function(t,s){var r=function(){return i&&!/^(get|post|head|put|delete|options)$/i.test(this.method)?(this.usingActiveXhr=!0,new ActiveXObject("Microsoft.XMLHTTP")):new XMLHttpRequest}();function o(){if(4===r.readyState){var e=1223===r.status?204:r.status;if(e<100||e>599)s(new TypeError("Network request failed"));else{var i={status:e,statusText:r.statusText,headers:m(r),url:"responseURL"in r?r.responseURL:/^X-Request-URL:/m.test(r.getAllResponseHeaders())?r.getResponseHeader("X-Request-URL"):void 0},n="response"in r?r.response:r.responseText;t(new f(n,i))}}}"cors"===n.credentials&&(r.withCredentials=!0),r.onreadystatechange=o,self.usingActiveXhr||(r.onload=o,r.onerror=function(){s(new TypeError("Network request failed"))}),r.open(n.method,n.url,!0),"responseType"in r&&e&&(r.responseType="blob"),n.headers.forEach((function(e,t){t.forEach((function(t){r.setRequestHeader(e,t)}))})),r.send(void 0===n._bodyInit?null:n._bodyInit)}))},fetch.Promise=self.Promise,self.fetch.polyfill=!0}function n(e){if("string"!=typeof e&&(e=e.toString()),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function r(e){return"string"!=typeof e&&(e=e.toString()),e}function o(e){this.map={};var t=this;e instanceof o?e.forEach((function(e,s){s.forEach((function(s){t.append(e,s)}))})):e&&Object.getOwnPropertyNames(e).forEach((function(s){t.append(s,e[s])}))}function l(e){if(e.bodyUsed)return fetch.Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function a(e){return new fetch.Promise((function(t,s){e.onload=function(){t(e.result)},e.onerror=function(){s(e.error)}}))}function u(e){var t=new FileReader;return t.readAsArrayBuffer(e),a(t)}function h(){return this.bodyUsed=!1,this._initBody=function(s){if(this._bodyInit=s,"string"==typeof s)this._bodyText=s;else if(e&&Blob.prototype.isPrototypeOf(s))this._bodyBlob=s;else if(t&&FormData.prototype.isPrototypeOf(s))this._bodyFormData=s;else{if(s)throw new Error("unsupported BodyInit type");this._bodyText=""}},e?(this.blob=function(){var e=l(this);if(e)return e;if(this._bodyBlob)return fetch.Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return fetch.Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(u)},this.text=function(){var e,t,s=l(this);if(s)return s;if(this._bodyBlob)return e=this._bodyBlob,(t=new FileReader).readAsText(e),a(t);if(this._bodyFormData)throw new Error("could not read FormData body as text");return fetch.Promise.resolve(this._bodyText)}):this.text=function(){var e=l(this);return e||fetch.Promise.resolve(this._bodyText)},t&&(this.formData=function(){return this.text().then(d)}),this.json=function(){return this.text().then((function(e){return JSON.parse(e)}))},this}function c(e,t){var i,n;if(t=t||{},this.url=e,this.credentials=t.credentials||"omit",this.headers=new o(t.headers),this.method=(i=t.method||"GET",n=i.toUpperCase(),s.indexOf(n)>-1?n:i),this.mode=t.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&t.body)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(t.body)}function d(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var s=e.split("="),i=s.shift().replace(/\+/g," "),n=s.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(n))}})),t}function m(e){var t=new o;return e.getAllResponseHeaders().trim().split("\n").forEach((function(e){var s=e.trim().split(":"),i=s.shift().trim(),n=s.join(":").trim();t.append(i,n)})),t}function f(e,t){t||(t={}),this._initBody(e),this.type="default",this.url=null,this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof o?t.headers:new o(t.headers),this.url=t.url||""}}();var s,i,n={};function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function u(e){return a(e)}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function d(e,t){return!t||"object"!=((s=t)&&s.constructor===Symbol?"symbol":typeof s)&&"function"!=typeof t?r(e):t;var s}s=n,i=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function t(e,t){var s,i=Object.keys(e);return Object.getOwnPropertySymbols&&(s=Object.getOwnPropertySymbols(e),t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)),i}function s(e){for(var s=1;s<arguments.length;s++){var i=null!=arguments[s]?arguments[s]:{};s%2?t(Object(i),!0).forEach((function(t){var s,n;s=e,t=i[n=t],n in s?Object.defineProperty(s,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[n]=t})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=new Array(t);s<t;s++)i[s]=e[s];return i}function n(e,t){var s;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(s=function(e,t){if(e){if("string"==typeof e)return i(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(s="Object"===s&&e.constructor?e.constructor.name:s)||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){s&&(e=s);var n=0;return{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){s=e[Symbol.iterator]()},n:function(){var e=s.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==s.return||s.return()}finally{if(l)throw r}}}}function r(e,t){for(var s=document.getElementsByClassName(e.resultsList.className),i=0;i<s.length;i++)t!==s[i]&&t!==e.inputField&&s[i].parentNode.removeChild(s[i]);e.inputField.removeAttribute("aria-activedescendant"),e.inputField.setAttribute("aria-expanded",!1)}function o(e,t,i){var n,r,o=(n=e,(r=document.createElement(n.resultsList.element)).setAttribute("id",n.resultsList.idName),r.setAttribute("aria-label",n.name),r.setAttribute("class",n.resultsList.className),r.setAttribute("role","listbox"),r.setAttribute("tabindex","-1"),n.resultsList.container&&n.resultsList.container(r),("string"==typeof n.resultsList.destination?document.querySelector(n.resultsList.destination):n.resultsList.destination()).insertAdjacentElement(n.resultsList.position,r),r);e.inputField.setAttribute("aria-expanded",!0);for(var l=function(n){var r,l,a,u,h=t.results[n];(u=(r=h,l=n,a=e,(u=document.createElement(a.resultItem.element)).setAttribute("id","".concat(a.resultItem.idName,"_").concat(l)),u.setAttribute("class",a.resultItem.className),u.setAttribute("role","option"),u.innerHTML=r.match,a.resultItem.content&&a.resultItem.content(r,u),u)).addEventListener("click",(function(r){r={event:r,matches:i,input:t.input,query:t.query,results:t.results,selection:s(s({},h),{},{index:n})},e.onSelection&&e.onSelection(r)})),o.appendChild(u)},a=0;a<t.results.length;a++)l(a);return o}function l(e,t,s){e.dispatchEvent(new CustomEvent(s,{bubbles:!0,detail:t,cancelable:!0}))}function a(e,t){for(var s=[],i=function(i){function r(n){var r=(n?o[n]:o).toString();r&&((r="function"==typeof e.searchEngine?e.searchEngine(t,r):function(e,t,s){var i=s.diacritics?t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").normalize("NFC"):t.toLowerCase();if("loose"===s.searchEngine){e=e.replace(/ /g,"");for(var n=[],r=0,o=0;o<i.length;o++){var l=t[o];r<e.length&&i[o]===e[r]&&(l=s.highlight?'<span class="autoComplete_highlighted">'.concat(l,"</span>"):l,r++),n.push(l)}if(r===e.length)return n.join("")}else if(i.includes(e))return e=new RegExp("".concat(e),"i").exec(t),s.highlight?t.replace(e,'<span class="autoComplete_highlighted">'.concat(e,"</span>")):t}(t,r,e))&&n?s.push({key:n,index:i,match:r,value:o}):r&&!n&&s.push({index:i,match:r,value:o}))}var o=e.data.store[i];if(e.data.key){var l,a=n(e.data.key);try{for(a.s();!(l=a.n()).done;)r(l.value)}catch(e){a.e(e)}finally{a.f()}}else r()},r=0;r<e.data.store.length;r++)i(r);return e.sort?s.sort(e.sort):s}var u;function h(e){!function(e){if(!(e instanceof h))throw new TypeError("Cannot call a class as a function")}(this);var t=void 0===(x=e.name)?"Search":x,s=void 0===(I=e.selector)?"#autoComplete":I,i=void 0!==(F=e.observer)&&F,n=(D=e.data).src,r=D.key,o=void 0!==(b=D.cache)&&b,l=D.store,a=D.results,u=e.query,c=void 0===(w=(O=void 0===(O=e.trigger)?{}:O).event)?["input"]:w,d=void 0!==(k=O.condition)&&k,m=void 0===(C=e.searchEngine)?"strict":C,f=void 0!==(L=e.diacritics)&&L,p=void 0===(T=e.threshold)?1:T,g=void 0===(S=e.debounce)?0:S,v=void 0===(E=(R=void 0===(R=e.resultsList)?{}:R).render)||E,_=void 0!==(P=R.container)&&P,y=R.destination,I=void 0===(x=R.position)?"afterend":x,b=void 0===(F=R.element)?"ul":F,w=void 0===(D=R.idName)?"autoComplete_list":D,k=void 0===(O=R.className)?"autoComplete_list":O,L=void 0!==(C=R.navigation)&&C,S=void 0!==(T=e.sort)&&T,E=e.placeHolder,x=void 0===(P=e.maxResults)?5:P,O=void 0!==(D=(F=void 0===(F=e.resultItem)?{}:F).content)&&D,C=void 0===(R=F.element)?"li":R,P=void 0===(T=F.idName)?"autoComplete_result":T,R=void 0===(D=F.className)?"autoComplete_result":D,T=e.noResults,D=void 0!==(F=e.highlight)&&F,F=e.feedback;e=e.onSelection;this.name=t,this.selector=s,this.observer=i,this.data={src:n,key:r,cache:o,store:l,results:a},this.query=u,this.trigger={event:c,condition:d},this.searchEngine=m,this.diacritics=f,this.threshold=p,this.debounce=g,this.resultsList={render:v,container:_,destination:y||this.selector,position:I,element:b,idName:w,className:k,navigation:L},this.sort=S,this.placeHolder=E,this.maxResults=x,this.resultItem={content:O,element:C,idName:P,className:R},this.noResults=T,this.highlight=D,this.feedback=F,this.onSelection=e,this.inputField="string"==typeof this.selector?document.querySelector(this.selector):this.selector(),this.observer?this.preInit():this.init()}return u=[{key:"start",value:function(e,t){var i=this,n=this.data.results?this.data.results(a(this,t)):a(this,t);t={input:e,query:t,matches:n,results:n.slice(0,this.maxResults)};return l(this.inputField,t,"results"),n.length?this.resultsList.render?(n.length&&o(this,t,n),l(this.inputField,t,"rendered"),function(e,t){function i(e,i,r,a){e.preventDefault(),r?n++:n--,o(i),a.inputField.setAttribute("aria-activedescendant",i[n].id),l(e.srcElement,s(s({event:e},t),{},{selection:t.results[n]}),"navigation")}var n=-1,o=function(e){if(!e)return!1;!function(e){for(var t=0;t<e.length;t++)e[t].removeAttribute("aria-selected"),e[t].classList.remove("autoComplete_selected")}(e),e[n=(n=n>=e.length?0:n)<0?e.length-1:n].setAttribute("aria-selected","true"),e[n].classList.add("autoComplete_selected")},a=e.resultsList.navigation||function(t){var s=document.getElementById(e.resultsList.idName);if(!s)return e.inputField.removeEventListener("keydown",a);s=s.getElementsByTagName(e.resultItem.element),27===t.keyCode?(e.inputField.value="",r(e)):40===t.keyCode||9===t.keyCode?i(t,s,!0,e):38===t.keyCode||9===t.keyCode?i(t,s,!1,e):13===t.keyCode&&(t.preventDefault(),-1<n&&s&&s[n].click())};e.inputField.autoCompleteNavigate&&e.inputField.removeEventListener("keydown",e.inputField.autoCompleteNavigate),e.inputField.autoCompleteNavigate=a,e.inputField.addEventListener("keydown",a)}(this,t),void document.addEventListener("click",(function(e){return r(i,e.target)}))):this.feedback(t):this.noResults?this.noResults(t,o):null}},{key:"dataStore",value:function(){var e=this;return new Promise((function(t,s){return e.data.cache&&e.data.store?t(null):new Promise((function(t,s){return"function"==typeof e.data.src?e.data.src().then(t,s):t(e.data.src)})).then((function(i){try{return e.data.store=i,l(e.inputField,e.data.store,"fetch"),t()}catch(e){return s(e)}}),s)}))}},{key:"compose",value:function(){var e=this;return new Promise((function(t,s){var i,n,o,l;function a(){return t()}return l=e.inputField,o=i=(l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement?l.value:l.innerHTML).toLowerCase(),n=(l=e).query&&l.query.manipulate?l.query.manipulate(o):l.diacritics?o.normalize("NFD").replace(/[\u0300-\u036f]/g,"").normalize("NFC"):o,l=n,((o=e).trigger.condition?o.trigger.condition(l):l.length>=o.threshold&&l.replace(/ /g,"").length)?e.dataStore().then((function(t){try{return r(e),e.start(i,n),a.call(e)}catch(e){return s(e)}}),s):(r(e),a.call(e))}))}},{key:"init",value:function(){var e,t,s,i,n=this;(e=this).inputField.setAttribute("type","text"),e.inputField.setAttribute("role","combobox"),e.inputField.setAttribute("aria-haspopup",!0),e.inputField.setAttribute("aria-expanded",!1),e.inputField.setAttribute("aria-controls",e.resultsList.idName),e.inputField.setAttribute("aria-autocomplete","both"),this.placeHolder&&this.inputField.setAttribute("placeholder",this.placeHolder),this.hook=(t=function(){n.compose()},s=this.debounce,function(){var e=this,n=arguments;clearTimeout(i),i=setTimeout((function(){return t.apply(e,n)}),s)}),this.trigger.event.forEach((function(e){n.inputField.removeEventListener(e,n.hook),n.inputField.addEventListener(e,n.hook)})),l(this.inputField,null,"init")}},{key:"preInit",value:function(){var e=this;new MutationObserver((function(t,s){var i,r=n(t);try{for(r.s();!(i=r.n()).done;)i.value,e.inputField&&(s.disconnect(),l(e.inputField,null,"connect"),e.init())}catch(e){r.e(e)}finally{r.f()}})).observe(document,{childList:!0,subtree:!0})}},{key:"unInit",value:function(){this.inputField.removeEventListener("input",this.hook),l(this.inputField,null,"unInit")}}],e(h.prototype,u),h},"object"==typeof n?n=i():"function"==typeof define&&define.amd?define(i):(s="undefined"!=typeof globalThis?globalThis:s||self).autoComplete=i();var m,f={},p="object"==typeof Reflect?Reflect:null,g=p&&"function"==typeof p.apply?p.apply:function(e,t,s){return Function.prototype.apply.call(e,t,s)};m=p&&"function"==typeof p.ownKeys?p.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var v=Number.isNaN||function(e){return e!=e};function _(){_.init.call(this)}(f=_).once=function(e,t){return new Promise((function(s,i){function n(s){e.removeListener(t,r),i(s)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",n),s([].slice.call(arguments))}O(e,t,r,{once:!0}),"error"!==t&&function(e,t,s){"function"==typeof e.on&&O(e,"error",t,s)}(e,n,{once:!0})}))},_.EventEmitter=_,_.prototype._events=void 0,_.prototype._eventsCount=0,_.prototype._maxListeners=void 0;var y=10;function I(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function b(e){return void 0===e._maxListeners?_.defaultMaxListeners:e._maxListeners}function w(e,t,s,i){var n,r,o,l;if(I(s),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,s.listener?s.listener:s),r=e._events),o=r[t]),void 0===o)o=r[t]=s,++e._eventsCount;else if("function"==typeof o?o=r[t]=i?[s,o]:[o,s]:i?o.unshift(s):o.push(s),(n=b(e))>0&&o.length>n&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,l=a,console&&console.warn&&console.warn(l)}return e}function k(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function L(e,t,s){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:s},n=k.bind(i);return n.listener=s,i.wrapFn=n,n}function S(e,t,s){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?s?[n.listener||n]:[n]:s?function(e){for(var t=new Array(e.length),s=0;s<t.length;++s)t[s]=e[s].listener||e[s];return t}(n):x(n,n.length)}function E(e){var t=this._events;if(void 0!==t){var s=t[e];if("function"==typeof s)return 1;if(void 0!==s)return s.length}return 0}function x(e,t){for(var s=new Array(t),i=0;i<t;++i)s[i]=e[i];return s}function O(e,t,s,i){if("function"==typeof e.on)i.once?e.once(t,s):e.on(t,s);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function n(r){i.once&&e.removeEventListener(t,n),s(r)}))}}Object.defineProperty(_,"defaultMaxListeners",{enumerable:!0,get:function(){return y},set:function(e){if("number"!=typeof e||e<0||v(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");y=e}}),_.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},_.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||v(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},_.prototype.getMaxListeners=function(){return b(this)},_.prototype.emit=function(e){for(var t=[],s=1;s<arguments.length;s++)t.push(arguments[s]);var i="error"===e,n=this._events;if(void 0!==n)i=i&&void 0===n.error;else if(!i)return!1;if(i){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var o=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw o.context=r,o}var l=n[e];if(void 0===l)return!1;if("function"==typeof l)g(l,this,t);else{var a=l.length,u=x(l,a);for(s=0;s<a;++s)g(u[s],this,t)}return!0},_.prototype.addListener=function(e,t){return w(this,e,t,!1)},_.prototype.on=_.prototype.addListener,_.prototype.prependListener=function(e,t){return w(this,e,t,!0)},_.prototype.once=function(e,t){return I(t),this.on(e,L(this,e,t)),this},_.prototype.prependOnceListener=function(e,t){return I(t),this.prependListener(e,L(this,e,t)),this},_.prototype.removeListener=function(e,t){var s,i,n,r,o;if(I(t),void 0===(i=this._events))return this;if(void 0===(s=i[e]))return this;if(s===t||s.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,s.listener||t));else if("function"!=typeof s){for(n=-1,r=s.length-1;r>=0;r--)if(s[r]===t||s[r].listener===t){o=s[r].listener,n=r;break}if(n<0)return this;0===n?s.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(s,n),1===s.length&&(i[e]=s[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},_.prototype.off=_.prototype.removeListener,_.prototype.removeAllListeners=function(e){var t,s,i;if(void 0===(s=this._events))return this;if(void 0===s.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==s[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete s[e]),this;if(0===arguments.length){var n,r=Object.keys(s);for(i=0;i<r.length;++i)"removeListener"!==(n=r[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=s[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},_.prototype.listeners=function(e){return S(this,e,!0)},_.prototype.rawListeners=function(e){return S(this,e,!1)},_.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):E.call(e,t)},_.prototype.listenerCount=E,_.prototype.eventNames=function(){return this._eventsCount>0?m(this._events):[]};let C={};const P=/[\\^$.*+?()[\]{}|]/g,R=RegExp(P.source),T=document.createElement("div"),D={containerTokenfield:'<div class="tokenfield tokenfield-mode-tokens">\n      <input class="tokenfield-copy-helper"\n        style="display:none;position:fixed;top:-1000px;right:1000px;"\n        tabindex="-1"\n        type="text"\n      />\n      <div class="tokenfield-set">\n        <ul></ul>\n      </div>\n      <input class="tokenfield-input" />\n      <div class="tokenfield-suggest">\n        <ul class="tokenfield-suggest-list"></ul>\n      </div>\n    </div>',containerList:'<div class="tokenfield tokenfield-mode-list">\n      <input class="tokenfield-input" />\n      <div class="tokenfield-suggest">\n        <ul class="tokenfield-suggest-list"></ul>\n      </div>\n      <div class="tokenfield-set">\n        <ul></ul>\n      </div>\n    </div>',suggestItem:'<li class="tokenfield-suggest-item"></li>',setItem:'<li class="tokenfield-set-item">\n      <span class="item-label"></span>\n      <a href="#" class="item-remove" tabindex="-1">×</a>\n      <input class="item-input" type="hidden" />\n    </li>'};function F(){return(65536*(1+Math.random())|0).toString(16)+(65536*(1+Math.random())|0).toString(16)}function N(e,t){return e.indexOf(t)>=0}function j(e){return e.nodeName?e:"string"==typeof e?document.querySelector(e):null}function A(e,t){return e.nodeName?e:(e=e.replace(/(\t|\n$)/g,""),T.innerHTML="",T.innerHTML=e,!0===t?T.childNodes:T.childNodes[0])}function M(e){return e.key||e.keyIdentifier?e.key||String.fromCharCode(parseInt(e.keyIdentifier.substr(2),16)):null}var H=function(e){"use strict";function t(){var e;return o(this,t),l(r(e=d(this,u(t).apply(this,arguments))),"_renderItem",(function(t,s){var i=e._options,n=e.renderSetItemHtml(t),r=n.querySelector(".item-label"),o=n.querySelector(".item-input"),l=n.querySelector(".item-remove");return n.key=t[e.key],l.key=t[e.key],o.setAttribute("name",t.isNew?i.newItemName:i.itemName),o.value=t[t.isNew?i.newItemValue:i.itemValue]||null,r.textContent=e.renderSetItemLabel(t),t.focused&&n.classList.add("focused"),n})),e}return c(t,e),t}(class extends(e(f)){constructor(e={}){super();let{_defaults:t,_options:s}={_defaults:{focusedItem:null,cache:{},timer:null,xhr:null,suggested:!1,suggestedItems:[],setItems:[],events:{},delimiters:{}},_options:{el:null,form:!0,mode:"tokenfield",addItemOnBlur:!1,addItemsOnPaste:!1,keepItemsOrder:!0,setItems:[],items:[],newItems:!0,multiple:!0,maxItems:0,minLength:0,keys:{17:"ctrl",16:"shift",91:"meta",8:"delete",27:"esc",37:"left",38:"up",39:"right",40:"down",46:"delete",65:"select",67:"copy",88:"cut",9:"delimiter",13:"delimiter",108:"delimiter"},matchRegex:"{value}",matchFlags:"i",matchStart:!1,matchEnd:!1,delimiters:[],copyProperty:"name",copyDelimiter:", ",remote:{type:"GET",url:null,queryParam:"q",delay:300,timestampParam:"t",params:{},headers:{}},placeholder:null,inputType:"text",minChars:2,maxSuggest:10,maxSuggestWindow:10,filterSetItems:!0,filterMatchCase:!1,singleInput:!1,singleInputValue:"id",singleInputDelimiter:", ",itemLabel:"name",itemName:"items",newItemName:"items_new",itemValue:"id",newItemValue:"name",itemData:"name",validateNewItem:null}};this.id=F(),this.key=`key_${this.id}`,this._vars=Object.assign({},t),this._options=Object.assign({},s,e),this._options.keys=Object.assign({},s.keys,e.keys),this._options.remote=Object.assign({},s.remote,e.remote),this._templates=Object.assign({},D,e.templates),this._vars.setItems=this._prepareData(this.remapData(this._options.setItems||[])),this._focused=!1,this._input=null,this._form=!1,this._html={};let i=this._options;i.delimiters.forEach((e=>{this._vars.delimiters[e]=!0}));let n=j(i.el);if(!n)throw new Error(`Selector: DOM Element ${i.el} not found.`);if(this.el=n,i.singleInput){let e=j(i.singleInput);this._input=e||this.el}if(this.el.tokenfield=this,null===i.placeholder&&(i.placeholder=i.el.placeholder||""),!i.form)throw new Error("Cannot create tokenfield without DOM Element.");{let e=!1;if(i.form.nodeName)e=i.form;else if(!0===i.form){let t=this.el;for(;t.parentNode;){if("FORM"===t.nodeName){e=t;break}t=t.parentNode}}else if("string"==typeof e&&(e=document.querySelector(e),!e))throw new Error(`Selector: DOM Element ${i.form} not found.`);this._form=e}C[this.id]=this,this._render()}_render(){let e=this._options,t=this._html;return"tokenfield"===e.mode?t.container=A(this._templates.containerTokenfield):t.container=A(this._templates.containerList),t.suggest=t.container.querySelector(".tokenfield-suggest"),t.suggestList=t.container.querySelector(".tokenfield-suggest-list"),t.items=t.container.querySelector(".tokenfield-set > ul"),t.input=t.container.querySelector(".tokenfield-input"),t.input.setAttribute("type",e.inputType),"tokenfield"===e.mode?t.input.placeholder=this._vars.setItems.length?"":e.placeholder:t.input.placeholder=e.placeholder,t.copyHelper=t.container.querySelector(".tokenfield-copy-helper"),e.el.style.display="none",t.suggest.style.display="none",this._renderSizer(),t.container.tokenfield=this,e.el.parentElement.insertBefore(t.container,e.el),t.container.insertBefore(e.el,t.container.firstChild),this._setEvents(),this._renderItems(),"tokenfield"===e.mode&&this._resizeInput(),this}_renderSizer(){let e=this._html,t=this._getBounds(),s=window.getComputedStyle(e.container),i=parseInt(s.paddingLeft,10)+parseInt(s.paddingRight,10),n={width:"auto",height:"auto",overflow:"hidden",whiteSpace:"pre",maxWidth:t.width-i+"px",position:"fixed",top:"-10000px",left:"10000px",fontSize:s.fontSize,paddingLeft:s.paddingLeft,paddingRight:s.paddingRight};e.sizer=document.createElement("div"),e.sizer.id="tokenfield-sizer-"+this.id;for(let t in n)e.sizer.style[t]=n[t];e.container.appendChild(e.sizer)}_minimizeInput(){return this._html.input.style.width="20px",this}_refreshInput(e=!0){let t=this._vars,s=this._html;if(e&&(s.input.value=""),"tokenfield"===this._options.mode){this._resizeInput();let e=t.setItems.length?"":this._options.placeholder;s.input.setAttribute("placeholder",e)}else"list"===this._options.mode&&s.input.setAttribute("placeholder",this._options.placeholder);return this}_resizeInput(e=""){let t=this._html,s=this._getBounds(),i=window.getComputedStyle(t.container),n=parseInt(i.paddingRight,10)+parseInt(i.borderRightWidth,10),r=n+parseInt(i.paddingLeft,10)+parseInt(i.borderLeftWidth,10);if(t.sizer.innerHTML=e,t.sizer.style.maxWidth=s.width-n+"px",0===s.width)return void(t.input.style.width="100%");t.input.style.width="20px";let o=t.sizer.getBoundingClientRect(),l=t.input.getBoundingClientRect(),a=s.width-(l.left-s.left)-n;o.width>a?t.input.style.width=s.width-r-1+"px":t.input.style.width=a-1+"px"}_fetchData(e){let t=this._vars,s=this._options,i=s.remote,n=Object.assign({},s.params);for(let e in i.params)n[e]=i.params[e];i.limit&&(n[i.limit]=s.remote.limit),n[i.queryParam]=e,n[i.timestampParam]=Math.round((new Date).getTime()/1e3),t.xhr=function(e,t={},s=null){let i=new XMLHttpRequest,n=t.url,r=[];for(let t in e)r.push(`${t}=${encodeURIComponent(e[t])}`);let o=r.join("&");"get"===t.type.toLowerCase()&&(n+="?"+o),i.open(t.type,n,!0);for(let s in t.headers){let n=t.headers[s];"function"==typeof n&&(n=n(e,t)),i.setRequestHeader(s,n)}return s&&(i.onreadystatechange=s),i.send(e),i}(n,s.remote,(()=>{if(t.xhr&&4==t.xhr.readyState){if(200==t.xhr.status){let i=JSON.parse(t.xhr.responseText);t.cache[e]=i;let n=this._prepareData(this.remapData(i)),r=this._filterData(e,n);t.suggestedItems=s.filterSetItems?this._filterSetItems(r):r,this.showSuggestions()}else if(t.xhr.status>0)throw new Error("Error while loading remote data.");this._abortXhr()}}))}remapData(e){return e}_prepareData(e){return e.map((e=>Object.assign({},e,{[this.key]:F()})))}_filterData(e,t){let s=this._options,i=s.matchRegex.replace("{value}",(n=function(e){if("string"==typeof e)return e;if(null===e)return"";let t=e+"";return"0"===t&&1/e==-1/0?"-0":t}(n=e))&&R.test(n)?n.replace(P,"\\$&"):n);var n;s.matchStart?i="^"+i:s.matchEnd&&(i+="$");let r=new RegExp(i,s.matchFlags);return t.filter((e=>r.test(e[s.itemData])))}_abortXhr(){let e=this._vars;null!==e.xhr&&(e.xhr.abort(),e.xhr=null)}_filterSetItems(e){const t=this._options.itemValue;let s=this._vars;if(!s.setItems.length)return e;let i=s.setItems.map((e=>e[t]));return e.filter((e=>-1===i.indexOf(e[t])))}_setEvents(){let e=this._vars,t=this._html;e.events.onClick=this._onClick.bind(this),e.events.onMouseDown=this._onMouseDown.bind(this),e.events.onMouseOver=this._onMouseOver.bind(this),e.events.onFocus=this._onFocus.bind(this),e.events.onResize=this._onResize.bind(this),e.events.onReset=this._onReset.bind(this),e.events.onKeyDown=this._onKeyDown.bind(this),e.events.onFocusOut=this._onFocusOut.bind(this),t.container.addEventListener("click",e.events.onClick),1===Object.keys(C).length&&(document.addEventListener("mousedown",e.events.onMouseDown),window.addEventListener("resize",e.events.onResize)),this._form&&this._form.nodeName&&this._form.addEventListener("reset",e.events.onReset),t.suggestList.addEventListener("mouseover",e.events.onMouseOver),t.input.addEventListener("focus",e.events.onFocus)}_onMouseOver(e){let t=e.target;if(t.classList.contains("tokenfield-suggest-item")){[].slice.call(this._html.suggestList.querySelectorAll(".selected")).forEach((e=>{e!==t&&e.classList.remove("selected")})),t.classList.add("selected"),this._selectItem(t.key,!1),this._refreshItemsSelection()}}_onReset(){this.setItems(this._options.setItems)}_onFocus(){let e=this._vars,t=this._html,s=this._options;t.input.removeEventListener("keydown",e.events.onKeyDown),t.input.addEventListener("keydown",e.events.onKeyDown),t.input.addEventListener("focusout",e.events.onFocusOut),s.addItemsOnPaste&&(e.events.onPaste=this._onPaste.bind(this),t.input.addEventListener("paste",e.events.onPaste)),this._focused=!0,this._html.container.classList.add("focused"),this._resizeInput(),t.input.value.trim().length>=s.minChars&&this.showSuggestions()}_onFocusOut(e){let t=this._vars,s=this._options,i=this._html;if(i.input.removeEventListener("keydown",t.events.onKeyDown),i.input.removeEventListener("focusout",t.events.onFocusOut),void 0!==t.events.onPaste&&i.input.removeEventListener("paste",t.events.onPaste),e.relatedTarget&&e.relatedTarget===i.copyHelper)return;let n=s.multiple&&!s.maxItems||!s.multiple&&!t.setItems.length||s.multiple&&s.maxItems&&t.setItems.length<s.maxItems;this._focused&&s.addItemOnBlur&&n&&this._newItem(i.input.value)?this._renderItems()._refreshInput():this._defocusItems()._renderItems(),this._focused=!1,this._html.container.classList.remove("focused")}_onMouseDown(e){let t=null;for(let s in C)if(C[s]._html.container.contains(e.target)){t=C[s];break}if(t){for(let e in C)e!==t.id&&(C[e].hideSuggestions(),C[e].blur());e.target!==t._html.input&&e.preventDefault()}else for(let e in C)C[e].hideSuggestions(),C[e].blur()}_onResize(){for(let e in C)C[e]._resizeInput(C[e]._html.input.value)}_onPaste(e){let t=this._vars,s=this._options,i=e.clipboardData.getData("text"),n=[i];if(s.delimiters.length){let e=s.delimiters.join("|"),t=new RegExp(`(${e})`,"ig");n=i.split(t)}n.map((e=>e.trim())).filter((e=>e.length>0&&e.length>=s.minLength&&void 0===t.delimiters[e])).map((e=>this._newItem(e))).length&&(setTimeout((()=>{this._renderItems()._refreshInput()._deselectItems().hideSuggestions()}),1),e.preventDefault())}_onKeyDown(e){let t=this._vars,s=this._options,i=this._html;s.maxItems&&t.setItems.length>=s.maxItems&&e.preventDefault(),"tokenfield"===s.mode&&setTimeout((()=>{this._resizeInput(i.input.value)}),1);let n=M(e);if(void 0!==s.keys[e.keyCode]||N(s.delimiters,n)){if(this._keyAction(e))return!0}else this._defocusItems()._refreshItems();clearTimeout(t.timer),this._abortXhr(),(!s.maxItems||t.setItems.length<s.maxItems)&&setTimeout((()=>{this._keyInput(e)}),1)}_keyAction(e){this.key;let t=null,s=this._vars,i=this._options,n=this._html,r=i.keys[e.keyCode],o=n.input.value.trim(),l=M(e);N(i.delimiters,l)&&void 0===r&&(r="delimiter");let a=this._getSelectedItems();switch(a.length&&(t=a[0]),r){case"esc":this._deselectItems()._defocusItems()._renderItems().hideSuggestions();break;case"up":this._vars.suggested&&(this._selectPrevItem()._refreshItemsSelection(),e.preventDefault()),this._defocusItems()._renderItems();break;case"down":this._vars.suggested&&(this._selectNextItem()._refreshItemsSelection(),e.preventDefault()),this._defocusItems()._renderItems();break;case"left":(this.getFocusedItems().length||!n.input.selectionStart&&!n.input.selectionEnd)&&(this._focusPrevItem(e.shiftKey),e.preventDefault());break;case"right":(this.getFocusedItems().length||n.input.selectionStart===o.length)&&(this._focusNextItem(e.shiftKey),e.preventDefault());break;case"delimiter":if(this._abortXhr(),this._defocusItems(),!i.multiple&&s.setItems.length>=1)return!1;o=this.onInput(o,e),t?this._addItem(t):o.length&&(t=this._newItem(o)),t&&this._minimizeInput()._renderItems().focus()._refreshInput()._refreshSuggestions()._deselectItems(),e.preventDefault();break;case"select":if(o.length||!e.ctrlKey&&!e.metaKey)return!1;this._vars.setItems.forEach((e=>{e.focused=!0})),this._refreshItems();break;case"cut":if(!this.getFocusedItems().length||!e.ctrlKey&&!e.metaKey)return!1;this._copy()._delete(e);break;case"copy":if(!this.getFocusedItems().length||!e.ctrlKey&&!e.metaKey)return!1;this._copy();break;case"delete":{this._abortXhr();let t=this.getFocusedItems();!n.input.selectionEnd&&8===e.keyCode||n.input.selectionStart===o.length&&46===e.keyCode||t.length?this._delete(e):s.timer=setTimeout((()=>{this._keyInput(e)}),i.delay);break}}return!0}_copy(){let e=this._options,t=this._html,s=this.getFocusedItems().map((t=>t[e.copyProperty])).join(e.copyDelimiter);return t.copyHelper.style.display="block",t.copyHelper.value=s,t.copyHelper.focus(),t.copyHelper.select(),document.execCommand("copy"),t.copyHelper.style.display="none",t.copyHelper.value="",t.input.focus(),this}_delete(e){let t=this._vars,s=this._options;const i=this.key;let n=this._html,r=this.getFocusedItems();return"tokenfield"===s.mode&&t.setItems.length?r.length?(r.forEach((e=>{this._removeItem(e[i])})),this._refreshSuggestions()._keyInput(e)):n.input.selectionStart||this._focusItem(t.setItems[t.setItems.length-1][i]):r.length&&(r.forEach((e=>{this._removeItem(e[i])})),this._refreshSuggestions()._keyInput(e)),this._minimizeInput()._renderItems()._refreshInput(!1),this}_keyInput(e){let t=this._vars,s=this._options,i=this._html;this._defocusItems()._refreshItems();const n=this.onInput(i.input.value.trim(),e);if("keydown"===e.type&&this.emit("input",this,n,e),n.length<s.minChars)return this.hideSuggestions(),!1;if(!s.multiple&&t.setItems.length>=1)return!1;if(void 0===t.cache[n]){if(s.remote.url)t.timer=setTimeout((()=>{this._fetchData(n)}),s.delay);else if(!s.remote.url&&s.items.length){let e=this._prepareData(s.items),i=this._filterData(n,e);t.suggestedItems=s.filterSetItems?this._filterSetItems(i):i,this.showSuggestions()}}else{let e=this._prepareData(this.remapData(t.cache[n])),i=this._filterData(n,e);t.suggestedItems=s.filterSetItems?this._filterSetItems(i):i,this.showSuggestions()}return this}_onClick(e){let t=e.target;if(t.classList.contains("item-remove"))e.preventDefault(),this._removeItem(t.key)._defocusItems()._minimizeInput()._renderItems()._refreshInput(!1)._keyInput(e);else if(t.classList.contains("tokenfield-suggest-item")){let e=this._getSuggestedItem(t.key);this._addItem(e)._minimizeInput()._renderItems()._refreshInput()._refreshSuggestions()}else{let s=function(e){let t=[e];for(;e.parentNode;)e=e.parentNode,t.push(e);return t}(t).filter((e=>e.classList&&e.classList.contains("tokenfield-set-item")))[0];s?(this._focusItem(s.key,e.shiftKey,e.ctrlKey||e.metaKey,!0),this._refreshItems()):this._keyInput(e)}this.focus()}_selectPrevItem(){const e=this.key,t=this._options;let s=this._vars.suggestedItems,i=this._getSelectedItemIndex();return s.length?(null!==i?0===i?t.newItems?this._deselectItems():this._selectItem(s[s.length-1][e]):this._selectItem(s[i-1][e]):this._selectItem(s[s.length-1][e]),this):this}_selectNextItem(){const e=this.key,t=this._options;let s=this._vars.suggestedItems,i=this._getSelectedItemIndex();return s.length?(null!==i?i===s.length-1?t.newItems?this._deselectItems():this._selectItem(s[0][e]):this._selectItem(s[i+1][e]):this._selectItem(s[0][e]),this):this}_focusPrevItem(e=!1){const t=this.key;let s=this._vars.setItems,i=this._getFocusedItemIndex();if(!s.length)return this;if(null!==i)if(0!==i||e)if(0===i&&e){let e=this._getFocusedItemIndex(!0);this._defocusItem(s[e][t])}else this._focusItem(s[i-1][t],e,!1,!0);else this._defocusItems();else this._focusItem(s[s.length-1][t],!1,!1,!0);return this._refreshItems(),this}_focusNextItem(e=!1){const t=this.key;let s=this._vars.setItems,i=this._getFocusedItemIndex(!0);return s.length?(null!==i?i!==s.length-1||e?i===s.length-1&&e?this._focusItem(s[0][t],e):this._focusItem(s[i+1][t],e):this._defocusItems():this._focusItem(s[0][t],!1),this._refreshItems(),this):this}_getSelectedItems(){const e=this.key;let t=this._vars.setItems.map((t=>t[e]));return this._vars.suggestedItems.filter((s=>s.selected&&t.indexOf(s[e])<0))}_selectItem(e,t=!1){this._vars.suggestedItems.forEach((s=>{if(s.selected=s[this.key]===e,s.selected&&t){let e=parseInt(this._html.suggest.style.maxHeight,10);if(e){let t=this._html.suggestList.getBoundingClientRect(),i=s.el.getBoundingClientRect(),n=i.top-t.top,r=n+i.height;r>=e+this._html.suggest.scrollTop?this._html.suggest.scrollTop=r-e:n<this._html.suggest.scrollTop&&(this._html.suggest.scrollTop=n)}}}))}_deselectItem(e){return this._vars.suggestedItems.every((t=>t[this.key]!==e||(t.selected=!1,!1))),this}_deselectItems(){return this._vars.suggestedItems.forEach((e=>{e.selected=!1})),this}_refreshItemsSelection(){this._vars.suggestedItems.forEach((e=>{e.selected&&e.el?e.el.classList.add("selected"):e.el&&e.el.classList.remove("selected")}))}_getSelectedItemIndex(){let e=null;return this._vars.suggestedItems.every(((t,s)=>!t.selected||(e=s,!1))),e}_getFocusedItemIndex(e=!1){let t=null;return this._vars.setItems.every(((s,i)=>!(s.focused&&(t=i,!e)))),t}_getItem(e,t=null){null===t&&(t=this.key);let s=this._filterItems(this._vars.setItems,e,t);return s.length?s[0]:null}_getSuggestedItem(e,t=null){null===t&&(t=this.key);let s=this._filterItems(this._vars.suggestedItems,e,t);return s.length?s[0]:null}_getAvailableItem(e,t=null){null===t&&(t=this.key);let s=this._filterItems(this._options.items,e,t);return s.length?s[0]:null}_filterItems(e,t,s){const i=this._options.filterMatchCase;return e.filter((e=>"string"==typeof e[s]&&"string"==typeof t?i?e[s]===t:e[s].toLowerCase()==t.toLowerCase():e[s]==t))}_removeItem(e){return this._vars.setItems.every(((t,s)=>t[this.key]!==e||(this.emit("removeToken",this,t),this._vars.setItems.splice(s,1),this.emit("removedToken",this,t),this.emit("change",this),!1))),this}_addItem(e){e.focused=!1;let t=this._options;if((e.isNew&&!this._getItem(e[t.itemData],t.itemData)||!this._getItem(e[t.itemValue],t.itemValue))&&(this.emit("addToken",this,e),!this._options.maxItems||this._options.maxItems&&this._vars.setItems.length<this._options.maxItems)){e.selected=!1;let t=Object.assign({},e);this._vars.setItems.push(t),this.emit("addedToken",this,t),this.emit("change",this)}return this}getFocusedItem(){let e=this._vars.setItems.filter((e=>e.focused))[0];return e.length?e[0]:null}getFocusedItems(){return this._vars.setItems.filter((e=>e.focused))}_focusItem(e,t=!1,s=!1,i=!1){if(t){let t=null,s=null,n=null,r=this._vars.setItems.length;if(this._vars.setItems.forEach(((i,r)=>{i[this.key]===e&&(n=r),null===t&&i.focused&&(t=r),i.focused&&(s=r)})),(0===n||n===r-1)&&null===t&&null===s)return;null===t&&null===s?this._vars.setItems[n].focused=!0:0!==n||s!==r-1||i?(t=Math.min(n,t),s=Math.max(n,s),this._vars.setItems.forEach(((e,i)=>{e.focused=n===i||i>=t&&i<=s}))):this._vars.setItems[t].focused=!1}else this._vars.setItems.forEach((t=>{t.focused=s?t[this.key]===e?!t.focused:t.focused:t[this.key]===e}));return this}_defocusItem(e){return this._vars.setItems.filter((t=>{t[this.key]===e&&(t.focused=!1)}))}_defocusItems(){return this._vars.setItems.forEach((e=>{e.focused=!1})),this}_newItem(e){let t=this._options;if("string"==typeof e&&(!e.length||e.length<t.minLength))return null;let s=this._getItem(e,t.itemData)||this._getSuggestedItem(e,t.itemData)||this._getAvailableItem(e,t.itemData);if(!s&&t.newItems){if("function"==typeof t.validateNewItem&&!t.validateNewItem(e))return null;s={isNew:!0,[this.key]:F(),[t.itemData]:e},this.emit("newToken",this,s)}return s?(this._addItem(s),s):null}_buildEl(e){return A(e)}_getBounds(){return this._html.container.getBoundingClientRect()}_renderItems(){let e=this._vars,t=this._options,s=this._html;return s.items.innerHTML="",e.setItems.forEach(((e,t)=>{let i=this._renderItem(e,t);s.items.appendChild(i),e.el=i,e.focused?e.el.classList.add("focused"):e.el.classList.remove("focused")})),e.setItems.length>1&&"tokenfield"===t.mode?s.input.setAttribute("placeholder",""):"list"===t.mode&&s.input.setAttribute("placeholder",t.placeholder),this._input&&(this._input.value=e.setItems.map((e=>e[t.singleInputValue])).join(t.singleInputDelimiter)),this}_refreshItems(){this._vars.setItems.forEach((e=>{e.el&&(e.focused?e.el.classList.add("focused"):e.el.classList.remove("focused"))}))}_renderItem(e,t){let s=this._options,i=this.renderSetItemHtml(e),n=i.querySelector(".item-label"),r=i.querySelector(".item-input"),o=i.querySelector(".item-remove"),l=s.keepItemsOrder?`[${t}]`:"[]";return i.key=e[this.key],o.key=e[this.key],r.setAttribute("name",(e.isNew?s.newItemName:s.itemName)+l),r.value=e[e.isNew?s.newItemValue:s.itemValue]||null,n.textContent=this.renderSetItemLabel(e),e.focused&&i.classList.add("focused"),i}onInput(e,t){return e}renderSetItemHtml(){return this._buildEl(this._templates.setItem)}renderSetItemLabel(e){return e[this._options.itemLabel]}renderSuggestions(e){let t=this._vars,s=this._options,i=this._html,n=this._getSelectedItemIndex();if(!e.length)return this;if(0===s.maxSuggestWindow&&(i.suggest.style.maxHeight=null),!t.suggestedItems.length)return this;s.newItems||null!==n||(e[0].selected=!0);let r=0;e.every(((e,t)=>{if(t>=s.maxSuggest)return!1;let n=i.suggestList.childNodes[t],o=e.el=this.renderSuggestedItem(e);return n?n.itemValue===e[s.itemValue]?(n.key=e[this.key],e.el=n):i.suggestList.replaceChild(o,n):n||i.suggestList.appendChild(o),s.maxSuggestWindow>0&&t<s.maxSuggestWindow&&(r+=i.suggestList.childNodes[t].getBoundingClientRect().height),s.maxSuggestWindow>0&&t===s.maxSuggestWindow&&(i.suggest.style.maxHeight=r+"px"),!0}));let o=i.suggestList.childElementCount-e.length;if(o>0)for(let t=o-1;t>=0;t--)i.suggestList.removeChild(i.suggestList.childNodes[e.length+t]);return this}renderSuggestedItem(e){let t=this._options,s=this._buildEl(this._templates.suggestItem);if(s.key=e[this.key],s.itemValue=e[t.itemValue],s.innerHTML=this.renderSuggestedItemContent(e),s.setAttribute("title",e[t.itemData]),e.selected&&s.classList.add("selected"),!t.filterSetItems){(this._getItem(e[t.itemValue],t.itemValue)||this._getItem(e[t.itemData],t.itemData))&&s.classList.add("set")}return s}renderSuggestedItemContent(e){return e[this._options.itemData]}_refreshSuggestions(){let e=this._vars,t=this._options;if(this._html.input.value.length<t.minChars)return this.hideSuggestions(),this;let s=this._prepareData(t.items),i=this._filterData(this._html.input.value,s);return e.suggestedItems=t.filterSetItems?this._filterSetItems(i):i,e.suggestedItems.length&&(!t.maxItems||t.maxItems&&e.setItems.length<t.maxItems)?(this.renderSuggestions(e.suggestedItems),this):(this.hideSuggestions(),this)}showSuggestions(){let e=this._vars,t=this._options;return e.suggestedItems.length?(this.emit("showSuggestions",this),(!t.maxItems||t.maxItems&&e.setItems.length<t.maxItems)&&(this._html.suggest.style.display="block",e.suggested=!0,this.renderSuggestions(e.suggestedItems)),this.emit("shownSuggestions",this)):this.hideSuggestions(),this}hideSuggestions(){return this.emit("hideSuggestions",this),this._vars.suggested=!1,this._html.suggest.style.display="none",this._html.suggestList.innerHTML="",this.emit("hiddenSuggestions",this),this}setSuggestedItems(e){if(!Array.isArray(e))throw new Error("Argument must be an array of objects.");this._options.items=e,this._refreshSuggestions()}getItems(){return this._vars.setItems.map((e=>{let t=Object.assign({},e);return delete t[this.key],delete t.el,t}))}setItems(e=[]){return this._vars.setItems=[],this.addItems(e),this}addItems(e=[]){const t=this._options.itemValue;return Array.isArray(e)||(e=[e]),this._prepareData(e).forEach((e=>{(e.isNew||void 0!==e[t])&&this._addItem(e)})),this._minimizeInput()._renderItems()._refreshInput().hideSuggestions(),this}sortItems(){let e=[];[...this._html.items.childNodes].forEach((t=>{let s=this._getItem(t.key);s&&e.push(s)})),this.setItems(e)}removeItem(e){const t=this._options;"object"==typeof e&&(e[t.itemValue]||e[t.newItemValue])&&(e=e[t.itemValue]||e[t.newItemValue]);let s=this._getItem(e,t.itemValue)||this._getItem(e,t.newItemValue);return s?(this._removeItem(s[this.key])._renderItems(),this):this}emptyItems(){return this._vars.setItems=[],this._renderItems()._refreshInput().hideSuggestions(),this.emit("change",this),this}getSuggestedItems(){return this._vars.suggestedItems.map((e=>Object.assign({},e)))}focus(){return this._html.container.classList.add("focused"),this._focused||this._html.input.focus(),this}blur(){return this._html.container.classList.remove("focused"),this._focused&&this._html.input.blur(),this}remove(){let e=this._html;e.container.parentElement.insertBefore(this.el,e.container),e.container.remove(),this.el.style.display="block",1===Object.keys(C).length&&(document.removeEventListener("mousedown",this._vars.events.onMouseDown),window.removeEventListener("resize",this._vars.events.onResize)),this._form&&this._form.nodeName&&this._form.removeEventListener("reset",this._vars.events.onReset),delete C[this.id],delete this.el.tokenfield}});window.TokenField=H}();
//# sourceMappingURL=review-good.js.map
